# Made by: Arthur Aguiar a,k,a: asepulve (13/08/2024)

# The .env file is loaded from the same directory in which the docker-compole.yml file is

# NGINX: (Nginx)
services:
  nginx:
    container_name: nginx
    build:
        context: ./requirements/nginx
        dockerfile: Dockerfile
    ports:
        - "443:443"
    networks:
        - inception
    env_file:
        - .env
    volumes:
        - wordpress:/var/www/html
    restart: on-failure

# Wordpress: (Wordpress+php-fpm) 
# Exposes the port to the host:
#    ports:
#        - "9000:9000"
  wordpress:
    container_name: wordpress
    build:
        context: ./requirements/wordpress
        dockerfile: Dockerfile
    expose:
        - "9000"
    networks:
        - inception
    env_file:
      - .env
    volumes:
        - wordpress:/var/www/html
    restart: on-failure

  mariadb:
    container_name: mariadb
    build:
        context: ./requirements/mariadb
        dockerfile: Dockerfile
    env_file:
      - .env
    expose:
        - "3306"
    networks:
        - inception
    volumes:
        - mariadb:/var/lib/mysql
    restart: on-failure

networks:
    inception:
        driver: bridge # Eliminates the need for routing between different network segments.
        name: inception # Forces the name of the network ot be inception

volumes:
    wordpress:
        name: wordpress
        driver: local
        driver_opts:
           type: "none"
           o: "bind"
           device: /home/asepulve/data/wordpress

    mariadb:
        name: mariadb
        driver: local 
        driver_opts:
           type: "none"
           o: "bind"
           device: /home/asepulve/data/mariadb

